{% extends "index.html" %}

{% block title %}Mapa - WebGIS Kevin{% endblock %}

{% block content %}
<div id="map-container">
    <div id="map"></div>
    
    <!-- Botão/Janela de Zoom recolhível no canto direito -->
    <div class="position-fixed" style="top: 24px; right: 32px; z-index: 2000; width: 260px;">
        <div class="card shadow border-0" style="border-radius: 2rem;">
            <div class="card-header d-flex justify-content-between align-items-center p-2" style="background:#ff9038; color:#fff; border-radius: 2rem;">
                <span class="fw-bold"><i class="fas fa-expand-arrows-alt me-2"></i> Zoom para</span>
                <button class="btn btn-sm btn-light" id="toggle-zoom-panel" title="Expandir painel"><i id="zoom-chevron" class="fas fa-chevron-down"></i></button>
            </div>
            <div class="collapse" id="zoom-panel-body">
                <button class="btn btn-outline-primary w-100 fw-bold py-2" id="zoom-leste-fluminense" style="border-radius:1.5rem; margin: 12px 0;">
                    Leste Fluminense
                </button>
            </div>
        </div>
    </div>

    <!-- Legenda de Cores -->
    <div class="position-fixed" style="bottom: 28px; right: 55px; z-index: 1000;">
        <div class="card shadow border-0" style="border-radius: 1rem; background: rgba(255,255,255,0.95);">
            <div class="card-header p-2" style="background:#005eb8; color:#fff; border-radius: 1rem;">
                <span class="fw-bold"><i class="fas fa-palette me-2"></i>Legenda</span>
            </div>
            <div class="card-body p-2">
                <div class="d-flex align-items-center mb-1">
                    <div style="width: 12px; height: 12px; background: #28a745; border-radius: 50%; margin-right: 8px;"></div>
                    <small>Municipal</small>
                </div>
                <div class="d-flex align-items-center mb-1">
                    <div style="width: 12px; height: 12px; background: #007bff; border-radius: 50%; margin-right: 8px;"></div>
                    <small>Estadual</small>
                </div>
                <div class="d-flex align-items-center mb-1">
                    <div style="width: 12px; height: 12px; background: #dc3545; border-radius: 50%; margin-right: 8px;"></div>
                    <small>Federal</small>
                </div>
                <div class="d-flex align-items-center mb-1">
                    <div style="width: 12px; height: 12px; background: #ffc107; border-radius: 50%; margin-right: 8px;"></div>
                    <small>Privada</small>
                </div>
                <div class="d-flex align-items-center">
                    <div style="width: 12px; height: 12px; background: #6c757d; border-radius: 50%; margin-right: 8px;"></div>
                    <small>Não informado</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Painel de Estatísticas do Município -->
    <div class="position-fixed" style="top: 24px; right: 320px; z-index: 2000; width: 300px; display: none; max-height: 80vh; overflow-y: auto;" id="stats-panel">
        <div class="card shadow border-0" style="border-radius: 2rem;">
            <div class="card-header d-flex justify-content-between align-items-center p-2" style="background:#005eb8; color:#fff; border-radius: 2rem;">
                <span class="fw-bold"><i class="fas fa-chart-bar me-2"></i> <span id="stats-municipio-nome">Município</span></span>
                <button class="btn btn-sm btn-light" id="close-stats-panel" title="Fechar painel"><i class="fas fa-times"></i></button>
            </div>
            <div class="card-body p-3">
                <div class="mb-3">
                    <h6 class="text-primary fw-bold mb-2">
                        <i class="fas fa-school me-2"></i>Resumo Geral
                    </h6>
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="bg-primary text-white rounded p-2 mb-2" style="color: white !important;">
                                <strong id="stats-total-escolas">0</strong>
                                <br><small>Total de Escolas</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-success text-white rounded p-2 mb-2">
                                <strong id="stats-escolas-publicas">0</strong>
                                <br><small>Públicas</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <h6 class="text-primary fw-bold mb-2">
                        <i class="fas fa-building me-2"></i>Por Dependência
                    </h6>
                    <div id="stats-dependencia" class="small">
                        <!-- Dados serão inseridos aqui -->
                    </div>
                </div>

                <div class="mb-3">
                    <h6 class="text-primary fw-bold mb-2">
                        <i class="fas fa-graduation-cap me-2"></i>Por Etapas de Ensino
                    </h6>
                    <div id="stats-etapas" class="small">
                        <!-- Dados serão inseridos aqui -->
                    </div>
                </div>

                <div class="mb-3">
                    <h6 class="text-primary fw-bold mb-2">
                        <i class="fas fa-users me-2"></i>Por Porte
                    </h6>
                    <div id="stats-porte" class="small">
                        <!-- Dados serão inseridos aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar com ferramentas -->
    <div class="sidebar minimized" id="sidebar" style="top: 24px;">
        <div class="sidebar-header d-flex justify-content-between align-items-center" style="justify-content: center !important;">
            <span class="sidebar-title text-white d-flex align-items-center" style="white-space:nowrap;">
                <i class="fas fa-desktop me-2" style="color:#ff9038;"></i>
                Central de Comando
            </span>
            <button id="toggle-sidebar" class="btn btn-sm btn-light ms-2" title="Expandir barra de ferramentas">
                <i id="sidebar-chevron" class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div class="sidebar-body">
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="text-muted mb-2">
                        <i class="fas fa-layer-group me-1"></i>
                        Mapas Base
                    </h6>
                    <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-base-maps" aria-expanded="false" aria-controls="collapse-base-maps">
                        <i id="chevron-base-maps" class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="collapse" id="collapse-base-maps">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="baseMap" id="cartodb" value="cartodb" checked>
                        <label class="form-check-label" for="cartodb">
                            CartoDB Positron
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="baseMap" id="google" value="google">
                        <label class="form-check-label" for="google">
                            Google Satellite
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="baseMap" id="osm" value="osm">
                        <label class="form-check-label" for="osm">
                            OpenStreetMap
                        </label>
                    </div>
                </div>
            </div>
            
            <hr>
            
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="text-muted mb-2">
                        <i class="fas fa-map" style="transform: rotate(-15deg);"></i>
                        Dados cartográficos
                    </h6>
                    <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-dados-cartograficos" aria-expanded="false" aria-controls="collapse-dados-cartograficos">
                        <i id="chevron-dados-cartograficos" class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="collapse" id="collapse-dados-cartograficos">
                    <div class="coordinates-display mb-2">
                        <strong>Coordenadas:</strong><br>
                        <span id="coordinates">Clique no mapa</span>
                    </div>
                    <div class="layer-info">
                        <strong>Informações:</strong><br>
                        <small>Zoom: <span id="zoom-level">5</span></small><br>
                        <small>Escala: <span id="scale">~1:10,000,000</span></small>
                    </div>
                </div>
            </div>

            <hr>

            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="text-muted mb-2">
                        <i class="fas fa-city me-1"></i>
                        Municípios
                    </h6>
                    <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-municipios" aria-expanded="false" aria-controls="collapse-municipios">
                        <i id="chevron-municipios" class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="collapse" id="collapse-municipios">
                    <div class="mb-2 ms-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-bold" style="color:#ff9038;"><i class="fas fa-map me-1"></i> Leste Fluminense</span>
                            <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-leste-flu" aria-expanded="false" aria-controls="collapse-leste-flu">
                                <i id="chevron-leste-flu" class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        <div class="collapse show" id="collapse-leste-flu">
                            <div class="form-check">
                                <input class="form-check-input municipio-checkbox" type="checkbox" value="Todos" id="municipio-todos" checked>
                                <label class="form-check-label" for="municipio-todos">Todos</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input municipio-checkbox" type="checkbox" value="Niterói" id="municipio-niteroi">
                                <label class="form-check-label" for="municipio-niteroi">Niterói</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input municipio-checkbox" type="checkbox" value="São Gonçalo" id="municipio-sao-goncalo">
                                <label class="form-check-label" for="municipio-sao-goncalo">São Gonçalo</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input municipio-checkbox" type="checkbox" value="Maricá" id="municipio-marica">
                                <label class="form-check-label" for="municipio-marica">Maricá</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input municipio-checkbox" type="checkbox" value="Itaboraí" id="municipio-itaborai">
                                <label class="form-check-label" for="municipio-itaborai">Itaboraí</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input municipio-checkbox" type="checkbox" value="Tanguá" id="municipio-tangua">
                                <label class="form-check-label" for="municipio-tangua">Tanguá</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input municipio-checkbox" type="checkbox" value="Rio Bonito" id="municipio-rio-bonito">
                                <label class="form-check-label" for="municipio-rio-bonito">Rio Bonito</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <hr>

            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="text-muted mb-2">
                        <i class="fas fa-filter me-1"></i>
                        Filtro por Tipo
                    </h6>
                    <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-tipos" aria-expanded="false" aria-controls="collapse-tipos">
                        <i id="chevron-tipos" class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="collapse" id="collapse-tipos">
                    <div class="mb-2 ms-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-bold" style="color:#ff9038;"><i class="fas fa-building me-1"></i> Por Dependência</span>
                            <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-dependencias" aria-expanded="false" aria-controls="collapse-dependencias">
                                <i id="chevron-dependencias" class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        <div class="collapse show" id="collapse-dependencias">
                            <div class="form-check">
                                <input class="form-check-input tipo-checkbox" type="checkbox" value="Todos" id="tipo-todos" checked>
                                <label class="form-check-label" for="tipo-todos">Todos os Tipos</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input tipo-checkbox" type="checkbox" value="Municipal" id="tipo-municipal">
                                <label class="form-check-label" for="tipo-municipal">Municipal</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input tipo-checkbox" type="checkbox" value="Estadual" id="tipo-estadual">
                                <label class="form-check-label" for="tipo-estadual">Estadual</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input tipo-checkbox" type="checkbox" value="Federal" id="tipo-federal">
                                <label class="form-check-label" for="tipo-federal">Federal</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input tipo-checkbox" type="checkbox" value="Privada" id="tipo-privada">
                                <label class="form-check-label" for="tipo-privada">Privada</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <hr>
            
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="text-muted mb-2">
                        <i class="fas fa-fire me-1"></i>
                        Heatmaps
                    </h6>
                    <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-heatmaps" aria-expanded="false" aria-controls="collapse-heatmaps">
                        <i id="chevron-heatmaps" class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="collapse" id="collapse-heatmaps">
                    <div class="form-check">
                        <input class="form-check-input heatmap-checkbox" type="checkbox" value="geral" id="heatmap-geral">
                        <label class="form-check-label" for="heatmap-geral">Geral</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input heatmap-checkbox" type="checkbox" value="municipio" id="heatmap-municipio">
                        <label class="form-check-label" for="heatmap-municipio">Por Município</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input heatmap-checkbox" type="checkbox" value="tipo" id="heatmap-tipo">
                        <label class="form-check-label" for="heatmap-tipo">Por Tipo</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}

<script src="{{ url_for('static', filename='js/map.js') }}"></script>
 
{% endblock %} 